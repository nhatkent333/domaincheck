name: Domain Monitor

on:
  schedule:
    # 1h s√°ng VN (UTC+7 = 18h h√¥m tr∆∞·ªõc UTC)
    - cron: "0 18 * * *"
    # 12h tr∆∞a VN (UTC+7 = 5h UTC)
    - cron: "0 5 * * *"
  workflow_dispatch: # cho ph√©p ch·∫°y th·ªß c√¥ng

jobs:
  monitor:
    runs-on: ubuntu-latest
    permissions:
      contents: write   # c·∫ßn ƒë·ªÉ push l√™n gh-pages

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.11"

      - name: Install dependencies
        run: |
          pip install --upgrade pip
          pip install requests python-whois beautifulsoup4 lxml

      - name: Run monitor script
        run: |
          python monitor.py
          echo "üìÇ Sau khi ch·∫°y script:"
          ls -lh
          test -f report.html && echo "‚úÖ report.html OK" || echo "‚ùå report.html kh√¥ng t·ªìn t·∫°i"
          mkdir -p docs
          cp report.html docs/index.html
          echo "üìÇ N·ªôi dung docs:"
          ls -lh docs
          head -n 20 docs/index.html || true

      - name: Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./docs
