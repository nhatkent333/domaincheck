name: Domain Monitor

on:
  schedule:
    # 1h s√°ng VN (UTC+7 = 18h h√¥m tr∆∞·ªõc UTC)
    - cron: "0 18 * * *"
    # 12h tr∆∞a VN (UTC+7 = 5h UTC)
    - cron: "0 5 * * *"
  workflow_dispatch: # cho ph√©p ch·∫°y th·ªß c√¥ng

jobs:
  monitor:
    runs-on: ubuntu-latest
    permissions:
      contents: write   # c·∫ßn quy·ªÅn ƒë·ªÉ push l√™n gh-pages

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.11"

      - name: Install dependencies
        run: |
          pip install --upgrade pip
          pip install requests python-whois beautifulsoup4 lxml

      - name: Run monitor script
        run: |
          echo "‚ñ∂Ô∏è Ch·∫°y monitor.py..."
          python monitor.py || echo "‚ùå monitor.py l·ªói"

          echo "üìÇ Li·ªát k√™ file sau khi ch·∫°y:"
          ls -lh

          if [ -f report.html ]; then
            echo "‚úÖ T√¨m th·∫•y report.html"
            head -n 20 report.html
            mkdir -p docs
            cp report.html docs/index.html
          else
            echo "‚ùå Kh√¥ng t√¨m th·∫•y report.html ‚Üí deploy ra trang b√°o l·ªói"
            mkdir -p docs
            echo "<h1>‚ùå Monitor script failed, kh√¥ng c√≥ report.html</h1>" > docs/index.html
          fi

          echo "üìÇ N·ªôi dung docs/"
          ls -lh docs

      - name: Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./docs
